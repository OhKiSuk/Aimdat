{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="row mt-5">
    <div class="col flex-grow-0">
        <div class="d-flex flex-column flex-shrink-0 p-3 text-white bg-white" style="min-width: 200px;">
            <ul class="nav nav-pills flex-column mb-auto font-sm">
                <li class="nav-item">
                    <a href="" class="nav-link active">회원정보</a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'account:password_change' %}" class="nav-link">비밀번호 변경</a>
                </li>
                <li class="nav-item">
                    <a href="" class="nav-link bg-danger text-white fw-bold" data-bs-toggle="modal" data-bs-target="#delete_account">회원 탈퇴하기</a>
                    <div class="modal fade text-black" id="delete_account" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                <h1 class="modal-title fs-6">회원 탈퇴</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                정말 탈퇴하시겠습니까? 탈퇴한 계정은 탈퇴 즉시 삭제되며, 복구할 수 없습니다.
                                </div>
                                <div class="modal-footer">
                                    <button id="id_delete_account" type="button" class="btn btn-sm btn-danger" data-bs-dismiss="modal">확인</button>
                                    <button type="button" class="btn btn-sm btn-primary" data-bs-dismiss="modal" aria-label="Close">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    
    <div class="col flex-grow-1">
        <div class="mt-2 font-lg fw-bold">회원정보</div>
        <div class="mt-3 font-md">
            <span class="fw-bold">이메일:</span> <span>{{ request.user.email }}</span>
            {% if request.user.user_classify == 'N' %} 
            <img src="{% static 'image/social/naver_button.png' %}" height="20px">
            {% elif request.user.user_classify == 'K' %}
            <img src="{% static 'image/social/kakao_button.png' %}" height="20px">
            {% elif request.user.user_classify == 'G' %}
            <img src="{% static 'image/social/google_button.png' %}" height="20px">
            {% endif %}
            <br>
            <span class="fw-bold">계정 만료일:</span> <span>{{ request.user.expiration_date|date:'Y-m-d' }}</span>
        </div>

        {% include 'includes/footer.html' %}
    </div>
</div>
{% endblock %}
{% block script %}
<script>
    $(document).ready(function() {
        $('#id_delete_account').on('click', function() {
            $.ajax({
                url: "{% url 'account:delete_account' %}",
                method: 'POST',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                },
                success: function(data) {
                    alert('회원탈퇴가 완료되었습니다.')
                    window.location.href = "{% url 'account:login' %}";
                }
            });
        });
    });
</script>
{% endblock %}